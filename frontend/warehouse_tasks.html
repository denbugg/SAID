<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ó–∞–¥–∞–Ω–∏—è —Å–∫–ª–∞–¥–∞ –Ω–∞ –æ—Ç–≥—Ä—É–∑–∫—É ‚Äî SAID-DONE</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <h2>üì¶ –ó–∞–¥–∞–Ω–∏—è –Ω–∞ –æ—Ç–≥—Ä—É–∑–∫—É —Å–æ —Å–∫–ª–∞–¥–∞</h2>

        <div id="tasks-list">
            <!-- –°—é–¥–∞ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –∑–∞–¥–∞–Ω–∏—è -->
        </div>
    </div>

    <script>
        async function loadTasks() {
            try {
                const response = await fetch("/api/warehouse/tasks");
                if (!response.ok) {
                    throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π");
                }
                const tasks = await response.json();
                renderTasks(tasks);
            } catch (error) {
                console.error(error);
                document.getElementById('tasks-list').innerText = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.";
            }
        }

        function renderTasks(tasks) {
            const list = document.getElementById('tasks-list');
            list.innerHTML = "";

            if (tasks.length === 0) {
                list.innerHTML = "<p>–ù–µ—Ç —Ç–µ–∫—É—â–∏—Ö –∑–∞–¥–∞–Ω–∏–π –Ω–∞ –æ—Ç–≥—Ä—É–∑–∫—É.</p>";
                return;
            }

            tasks.forEach(task => {
                const div = document.createElement("div");
                div.classList.add("task-item");
                div.innerHTML = `
                    <h3>–ü—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏: ${task.pickup_point}</h3>
                    <p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤: ${task.order_count}</p>
                    <p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∑–∏—Ü–∏–π: ${task.item_count}</p>
                    <button onclick="startIssue(${task.id})">üîÑ –ù–∞—á–∞—Ç—å –æ—Ç–≥—Ä—É–∑–∫—É</button>
                `;
                list.appendChild(div);
            });
        }

        function startIssue(taskId) {
            localStorage.setItem("selected_task_id", taskId);
            window.location.href = "/frontend/warehouse_issue.html";
        }

        loadTasks();
    </script>
</body>
</html>
